# 修仙战旗 - iOS游戏产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
**游戏名称**: 修仙战旗  
**平台**: iOS  
**类型**: Roguelike + RPG + 战旗策略  
**目标用户**: 18-35岁喜欢策略游戏和修仙题材的玩家  
**商业模式**: 免费游戏 + 内购 + 广告变现  

### 1.2 核心卖点
- 深度的修仙成长系统
- 策略性战旗战斗
- 随机生成的修仙世界
- 丰富的法宝和功法收集
- 宗门建设和弟子培养

## 2. 游戏核心玩法

### 2.1 Roguelike元素
- **随机地图生成**: 每次进入秘境都有不同的地形和怪物分布
- **随机事件**: 机缘巧合、奇遇、危机等随机触发
- **随机奖励**: 功法、法宝、丹药的随机掉落
- **永久进度**: 死亡后保留部分修为和收集品

### 2.2 RPG成长系统
- **境界系统**: 练气→筑基→金丹→元婴→化神→合体→大乘→渡劫
- **属性系统**: 灵力、体质、神识、悟性、运气
- **功法系统**: 五行功法(金木水火土)、特殊功法
- **法宝系统**: 攻击、防御、辅助类法宝，可升级强化
- **丹药系统**: 回复、增益、突破类丹药

### 2.3 战旗战斗系统
- **六边形格子**: 战场采用六边形网格
- **回合制**: 根据灵敏度决定行动顺序
- **技能组合**: 不同功法可以组合出强力连招
- **阵法系统**: 布置不同阵法获得战略优势
- **天气系统**: 天候影响战斗效果

## 3. 游戏系统设计

### 3.1 主界面模块
```
主界面
├── 修炼模块 (提升境界)
├── 战斗模块 (进入秘境战斗)
├── 背包模块 (管理物品)
├── 功法模块 (学习和升级功法)
├── 宗门模块 (建设和管理)
├── 商店模块 (购买物品)
└── 设置模块
```

### 3.2 核心循环
1. **修炼提升** → 获得修为和属性点
2. **探索秘境** → 战斗获得资源和经验
3. **收集强化** → 获得更强的功法和法宝
4. **挑战更高难度** → 进入更危险的秘境
5. **突破境界** → 解锁新的能力和区域

### 3.3 战斗流程
1. **准备阶段**: 选择出战弟子、法宝、丹药
2. **布阵阶段**: 在战场上布置初始位置
3. **战斗阶段**: 回合制策略战斗
4. **结算阶段**: 获得经验、物品奖励

## 4. 变现设计

### 4.1 内购项目
- **灵石包**: 游戏内货币，加速修炼和购买稀有物品
- **月卡系统**: 每日登录获得额外奖励
- **法宝礼包**: 稀有法宝和功法组合包
- **修炼加速**: 减少修炼等待时间
- **秘境通行证**: 解锁高级秘境

### 4.2 广告变现
- **奖励视频**: 观看广告获得双倍奖励
- **复活广告**: 战斗失败后观看广告复活
- **免费抽奖**: 每日免费抽奖次数

### 4.3 留存机制
- **每日任务**: 登录、战斗、修炼任务
- **活动系统**: 限时活动和节日庆典
- **排行榜**: 实力榜、宗门榜、财富榜
- **社交系统**: 好友系统、宗门聊天

## 5. 技术架构

### 5.1 开发框架
- **引擎**: SpriteKit + GameplayKit
- **UI框架**: UIKit + SwiftUI (部分界面)
- **数据存储**: Core Data + UserDefaults
- **网络**: URLSession + Codable
- **音效**: AVAudioEngine

### 5.2 项目结构
```
xiuxian/
├── Core/               // 核心系统
│   ├── GameManager.swift
│   ├── SaveSystem.swift
│   └── AudioManager.swift
├── Models/             // 数据模型
│   ├── Player.swift
│   ├── Character.swift
│   ├── Item.swift
│   └── Battle.swift
├── Scenes/             // 游戏场景
│   ├── MainMenuScene.swift
│   ├── BattleScene.swift
│   └── MapScene.swift
├── UI/                 // 界面组件
│   ├── Components/
│   └── ViewControllers/
├── Assets/             // 美术资源
│   ├── Textures/
│   ├── Sounds/
│   └── Animations/
└── Data/               // 配置数据
    ├── Characters.json
    ├── Items.json
    └── Skills.json
```

### 5.3 性能优化
- **对象池**: 复用频繁创建的对象
- **纹理图集**: 合并小纹理减少Draw Call
- **LOD系统**: 远距离物体使用低精度模型
- **内存管理**: 及时释放不用的资源

## 6. 美术风格

### 6.1 视觉风格
- **2D手绘风格**: 中国传统水墨画风格
- **UI设计**: 古风界面，使用传统纹饰
- **色彩搭配**: 以青、蓝、金为主色调
- **特效**: 华丽的法术特效和灵力流动

### 6.2 角色设计
- **主角形象**: 可自定义的修仙者
- **NPC设计**: 各种修仙门派的特色人物
- **怪物设计**: 妖兽、魔族、邪修等敌人

### 6.3 场景设计
- **修炼洞府**: 主角的修炼场所
- **宗门**: 各种建筑和设施
- **秘境**: 神秘的探险区域
- **战斗场景**: 多样化的战斗地形

## 7. 音效设计

### 7.1 背景音乐
- **主菜单**: 悠扬的古典音乐
- **修炼**: 宁静的冥想音乐
- **战斗**: 激昂的战斗音乐
- **探索**: 神秘的环境音乐

### 7.2 音效
- **UI音效**: 按钮点击、页面切换
- **战斗音效**: 技能释放、攻击命中
- **环境音效**: 风声、水声、鸟鸣

## 8. 开发计划

### 8.1 阶段一 (1-2个月) - 核心系统 ✅ 已完成试玩版本
- [x] ✅ 核心游戏循环系统
- [x] ✅ 角色成长系统 (境界、属性、修炼)
- [x] ✅ 基础UI框架 (SpriteKit界面)
- [x] ✅ 数据存储系统 (存档/读档)
- [x] ✅ 物品系统 (法宝、丹药、装备)
- [x] ✅ 技能系统 (五行功法、境界技能)
- [x] ✅ 音效系统框架 (预留美术资源接口)
- [x] ✅ 游戏状态管理 (修炼、背包、商店等模块)
- [x] ✅ UI布局适配 (修复iPhone屏幕尺寸适配问题)
- [x] ✅ 视觉效果优化 (星空背景、按钮样式、渐变效果)

#### 最新修复记录 (v0.1.1)
**问题**: 游戏界面布局混乱，显示"Hello, World"等模板内容
**原因**: GameViewController从.sks文件加载场景，包含默认模板内容
**解决方案**:
1. 修改GameViewController直接实例化GameScene类
2. 优化UI布局，添加安全区域适配
3. 重新设计按钮样式和位置布局
4. 添加修仙风格的背景特效(星空、渐变)
5. 调整字体大小和颜色，提升可读性

**改进效果**:
- ✅ 界面布局整齐，适配不同iPhone屏幕尺寸
- ✅ 修仙风格的视觉体验(金色标题、深蓝背景、闪烁星空)
- ✅ 按钮具有立体感和点击反馈
- ✅ 信息显示清晰，字体大小合适
- ✅ 符合iOS开发规范的安全区域处理

### 8.2 阶段二 (2-3个月) - 玩法完善
- [ ] Roguelike地图生成
- [ ] 完整的战旗战斗
- [ ] 功法和法宝系统
- [ ] 基础美术资源

### 8.3 阶段三 (1-2个月) - 优化和发布
- [ ] 性能优化
- [ ] 音效和音乐
- [ ] 内购和广告集成
- [ ] 测试和发布

## 9. 风险评估

### 9.1 技术风险
- **性能风险**: 复杂战斗场景可能影响性能
- **存储风险**: 大量数据需要合理的存储策略

### 9.2 市场风险
- **竞争风险**: 市场上已有类似游戏
- **用户留存**: 需要持续更新内容保持用户兴趣

### 9.3 规避措施
- **技术**: 采用成熟的优化方案
- **市场**: 突出独特的修仙题材和创新玩法
- **运营**: 建立完善的用户反馈和更新机制

## 10. 成功指标

### 10.1 用户指标
- **DAU**: 日活跃用户数 > 10,000
- **留存率**: 7日留存 > 30%
- **会话时长**: 平均会话 > 15分钟

### 10.2 收入指标
- **ARPU**: 每用户平均收入 > $5
- **付费率**: 付费用户比例 > 5%
- **LTV**: 用户生命周期价值 > $20

---

## 💯 试玩版本已完成 Demo

### 🎮 当前可试玩功能
1. **核心修炼系统** - 点击"开始修炼"持续获得修为，自动境界突破
2. **完整角色成长** - 境界提升、属性分配、技能学习
3. **实时UI更新** - 显示角色状态、境界、战斗力等信息
4. **存档系统** - 自动保存/读取游戏进度
5. **物品收集** - 随机获得稀有法宝和丹药
6. **音效反馈** - 按钮点击、境界突破等音效提示

### 🔧 技术架构特点
- ✅ **模块化设计** - 核心系统、数据模型、UI组件完全分离
- ✅ **美术资源预留** - 所有UI、物品、技能都预留了图标变量
- ✅ **可扩展架构** - 战斗系统、宗门系统等可无缝集成
- ✅ **iOS开发规范** - 遵循SpriteKit最佳实践
- ✅ **存档兼容性** - JSON格式存档，支持版本升级

### 📱 运行说明
```bash
# 编译命令
xcodebuild -project xiuxian.xcodeproj -scheme xiuxian -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.4' build

# 或在Xcode中直接运行
```

### 🎯 下一阶段重点
1. **战旗战斗系统** - 六边形格子战场
2. **Roguelike地图** - 随机生成秘境
3. **美术资源集成** - 替换占位符图标
4. **战斗AI系统** - 敌人行为策略

---

**文档版本**: v1.1  
**创建日期**: 2024年  
**最后更新**: 2024年12月  
**负责人**: 开发团队  
**试玩版本**: ✅ Alpha 0.1 可运行 